extends ../../layouts/default
block styles
    link(rel="stylesheet", href="/public/admin/css/user-form.css")

block main
  .form-container
    // Header
    .form-header
      .d-flex.align-items-center.gap-3
        i.bi.bi-person-gear.fs-2
        div
          h2= mode==='create' ? 'T·∫°o ng∆∞·ªùi d√πng m·ªõi' : 'Ch·ªânh s·ª≠a th√¥ng tin ng∆∞·ªùi d√πng'
          p.mb-0= mode==='create' ? 'Nh·∫≠p th√¥ng tin ƒë·ªÉ t·∫°o t√†i kho·∫£n m·ªõi' : 'C·∫≠p nh·∫≠t th√¥ng tin t√†i kho·∫£n'

    // Error Alert
    if error
      .alert.alert-danger
        i.bi.bi-exclamation-triangle.me-2
        = error

    // Main Form Card
    form(method="post" enctype="multipart/form-data" action= mode==='create' ? `${prefixAdmin}/users` : `${prefixAdmin}/users/${userDoc._id}?_method=PUT`)
      .form-card
        .p-4
          .row
            // Left Column - Basic Info
            .col-lg-8
              // Personal Information Section
              .form-section
                .section-title
                  i.bi.bi-person
                  | Th√¥ng tin c√° nh√¢n
                
                .row
                  .col-md-6.mb-3
                    label.form-label H·ªç v√† t√™n *
                    input.form-control(type="text" name="fullName" required value=userDoc.fullName || '' placeholder="Nh·∫≠p h·ªç t√™n ƒë·∫ßy ƒë·ªß")
                  
                  .col-md-6.mb-3
                    label.form-label Email *
                    input.form-control(type="email" name="email" required value=userDoc.email || '' placeholder="email@example.com")
                
                .row
                  .col-md-6.mb-3
                    label.form-label T√™n ƒëƒÉng nh·∫≠p
                    input.form-control(type="text" name="username" value=userDoc.username || '' placeholder="ƒê·ªÉ tr·ªëng s·∫Ω t·ª± t·∫°o t·ª´ email")
                  
                  .col-md-6.mb-3
                    label.form-label M·∫≠t kh·∫©u
                    input.form-control(type="password" name="password" placeholder= mode==='create' ? "M·∫∑c ƒë·ªãnh: Password@123" : "ƒê·ªÉ tr·ªëng n·∫øu kh√¥ng thay ƒë·ªïi")

              // Account Settings Section
              .form-section
                .section-title
                  i.bi.bi-gear
                  | C√†i ƒë·∫∑t t√†i kho·∫£n
                
                .row
                  .col-md-6.mb-3
                    label.form-label Tr·∫°ng th√°i
                    - const st = userDoc.status || 'ACTIVE'
                    select.form-select(name="status")
                      option(value="ACTIVE" selected=st==='ACTIVE') ‚úÖ Ho·∫°t ƒë·ªông
                      option(value="INACTIVE" selected=st==='INACTIVE') ‚è∏Ô∏è T·∫°m ng∆∞ng
                      option(value="LOCKED" selected=st==='LOCKED') üîí Kh√≥a

                  .col-md-6.mb-3
                    label.form-label Vai tr√≤
                    - const roles = userDoc.roles || (mode==='create' ? ['INSTRUCTOR'] : [])
                    .role-group
                      .form-check.form-check-inline
                        input.form-check-input(type="checkbox" id="role_student" name="roles" value="STUDENT" checked=roles.includes('STUDENT'))
                        label.form-check-label(for="role_student") 
                          i.bi.bi-mortarboard.me-1
                          | H·ªçc vi√™n
                      .form-check.form-check-inline
                        input.form-check-input(type="checkbox" id="role_instructor" name="roles" value="INSTRUCTOR" checked=roles.includes('INSTRUCTOR'))
                        label.form-check-label(for="role_instructor")
                          i.bi.bi-person-video2.me-1
                          | Gi·∫£ng vi√™n
                      .form-check.form-check-inline
                        input.form-check-input(type="checkbox" id="role_admin" name="roles" value="ADMIN" checked=roles.includes('ADMIN'))
                        label.form-check-label(for="role_admin")
                          i.bi.bi-shield-check.me-1
                          | Qu·∫£n tr·ªã

            // Right Column - Avatar
            .col-lg-4
              .form-section
                .section-title
                  i.bi.bi-image
                  | ·∫¢nh ƒë·∫°i di·ªán
                
                .avatar-preview
                  // Current Avatar Display
                  if userDoc && userDoc.avatarUrl
                    .mb-3
                      img.avatar-current.rounded-circle(src=userDoc.avatarUrl alt="Avatar hi·ªán t·∫°i" width="100" height="100" style="object-fit: cover;")
                    .form-check.mb-3
                      input.form-check-input(type="checkbox" id="remove_avatar" name="removeAvatar" value="1")
                      label.form-check-label(for="remove_avatar").text-danger
                        i.bi.bi-trash.me-1
                        | X√≥a ·∫£nh hi·ªán t·∫°i
                  else
                    .mb-3
                      .avatar-placeholder.rounded-circle.mx-auto.d-flex.align-items-center.justify-content-center(style="width: 100px; height: 100px;")
                        i.bi.bi-person.fs-1.text-muted
                  
                  // File Upload
                  .mb-3
                    input.form-control(type="file" name="avatar" accept="image/*" id="avatar_upload")
                    .form-text.text-muted.small Ch·ªçn ·∫£nh JPG, PNG (t·ªëi ƒëa 2MB)

          // Action Buttons
          .form-actions
            .d-flex.justify-content-between.align-items-center
              .text-muted.small
                i.bi.bi-info-circle.me-1
                | C√°c tr∆∞·ªùng c√≥ d·∫•u * l√† b·∫Øt bu·ªôc
              
              .d-flex.gap-2
                a.btn.btn-outline-secondary(href=`${prefixAdmin}/users`)
                  i.bi.bi-arrow-left.me-1
                  | Quay l·∫°i
                button.btn.btn-primary(type="submit")
                  i.bi.bi-check-lg.me-1
                  = mode==='create' ? 'T·∫°o t√†i kho·∫£n' : 'C·∫≠p nh·∫≠t'

    // Additional Notes Card
    if mode === 'create'
      .notes-card
        .d-flex.align-items-start.gap-2
          i.bi.bi-lightbulb.text-info.mt-1
          .small
            strong L∆∞u √Ω quan tr·ªçng:
            ul
              li M·∫≠t kh·∫©u m·∫∑c ƒë·ªãnh s·∫Ω l√† "Password@123" n·∫øu ƒë·ªÉ tr·ªëng
              li Username s·∫Ω ƒë∆∞·ª£c t·∫°o t·ª± ƒë·ªông t·ª´ email n·∫øu kh√¥ng nh·∫≠p
              li Vai tr√≤ "Gi·∫£ng vi√™n" ƒë∆∞·ª£c ch·ªçn m·∫∑c ƒë·ªãnh