extends ../../layouts/default
block styles
  link(rel="stylesheet", href="/public/admin/css/course-form.css")

block main
  .form-container
    // Header
    .form-header
      .d-flex.align-items-center.gap-3
        i.bi.bi-journal-text.fs-2
        div
          h2= mode==='create' ? 'Tạo khóa học mới' : 'Chỉnh sửa khóa học'
          p.mb-0= mode==='create' ? 'Nhập thông tin để xuất bản một khóa học mới' : 'Cập nhật nội dung và thiết lập khóa học'

    // Error Alert
    if error
      .alert.alert-danger
        i.bi.bi-exclamation-triangle.me-2
        = error

    // Main Form
    form(
      method="post"
      enctype="multipart/form-data"
      action=(mode==='create'
        ? `${prefixAdmin}/courses/create`
        : `${prefixAdmin}/courses/${course._id}/edit?_method=PUT`)
    )
      // Card chính
      .form-card
        .p-4
          .row
            // LEFT: thông tin nội dung
            .col-lg-8
              // Thông tin cơ bản
              .form-section
                .section-title
                  i.bi.bi-info-circle
                  | Thông tin cơ bản
                .row
                  .col-md-12.mb-3
                    label.form-label Tiêu đề *
                    input.form-control(type="text" name="title" required value=course.title || '' placeholder="Nhập tiêu đề khóa học")

                  .col-md-12.mb-3
                    label.form-label Đường dẫn (slug) *
                    input.form-control(type="text" name="slug" required value=course.slug || '' placeholder="duong-dan-khoa-hoc")

                  .col-md-12.mb-3
                    label.form-label Mô tả
                    textarea.form-control(name="description" rows="6" placeholder="Nhập mô tả chi tiết về khóa học...")= course.description

              // Thiết lập khóa học
              .form-section
                .section-title
                  i.bi.bi-gear
                  | Thiết lập khóa học
                .row
                  .col-md-6.mb-3
                    label.form-label Chủ đề
                    if topics && topics.length
                      select.form-select(name="topic")
                        option(value="") -- Chọn chủ đề --
                        each t in topics
                          option(
                            value=t._id
                            selected=(course.topic && String(course.topic)===String(t._id))
                          )= t.name
                    else
                      .no-data Chưa có chủ đề nào

                  .col-md-6.mb-3
                    label.form-label Cấp độ
                    - const levels = [['BEGINNER','Cơ bản'],['INTERMEDIATE','Trung cấp'],['ADVANCED','Nâng cao']]
                    select.form-select(name="level")
                      each lv in levels
                        option(value=lv[0] selected=(course.level===lv[0]))= lv[1]

                .row
                  .col-md-6.mb-3
                    label.form-label Giá gốc
                    input.form-control(type="number" step="1000" name="price" value=course.price || 0 placeholder="0")
                  .col-md-6.mb-3
                    label.form-label Giá khuyến mãi
                    input.form-control(type="number" step="1000" name="salePrice" value=course.salePrice || '' placeholder="0")

                .row
                  .col-md-6.mb-3
                    label.form-label Trạng thái
                    - const statuses = [['DRAFT','Bản nháp'],['PUBLISHED','Đã xuất bản'],['UNLISTED','Không công khai'],['ARCHIVED','Lưu trữ']]
                    select.form-select(name="status")
                      each s in statuses
                        option(value=s[0] selected=(course.status===s[0]))= s[1]
                  .col-md-6.mb-3
                    label.form-label Hiển thị
                    select.form-select(name="visibility")
                      option(value="PUBLIC" selected=(course.visibility==='PUBLIC')) Công khai
                      option(value="PRIVATE" selected=(course.visibility==='PRIVATE')) Riêng tư

                .mb-3
                  label.form-label Giảng viên phụ trách
                  if instructors && instructors.length
                    select.form-select(name="instructors" multiple)
                      each ins in instructors
                        - const sel = (course.instructors || []).some(x => String(x.user?._id || x.user) === String(ins._id))
                        option(value=ins._id selected=sel)= ins.fullName || ins.email
                  else
                    .no-data Chưa có giảng viên nào

            // RIGHT: ảnh khóa học
            .col-lg-4
              .form-section
                .section-title
                  i.bi.bi-image
                  | Ảnh khóa học

                .avatar-preview
                  if course && course.imageUrl
                    .mb-3
                      img.avatar-current.rounded(src=course.imageUrl alt="Course image" width="100" height="100" style="object-fit:cover;")
                    .form-text.text-muted.small Ảnh hiện tại
                  else
                    .mb-3
                      .avatar-placeholder.rounded-circle.mx-auto.d-flex.align-items-center.justify-content-center(style="width:100px;height:100px;")
                        i.bi.bi-image.fs-1.text-muted

                .mb-3
                  input.form-control(type="file" name="image" accept="image/*" id="course_image")
                  .form-text.text-muted.small Chọn ảnh JPG/PNG/WebP (tối đa 2MB)

      // Action Buttons
      .form-actions
        .d-flex.justify-content-between.align-items-center
          .text-muted.small
            i.bi.bi-info-circle.me-1
            | Các trường có dấu * là bắt buộc
          .d-flex.gap-2
            a.btn.btn-outline-secondary(href=`${prefixAdmin}/courses`)
              i.bi.bi-arrow-left.me-1
              | Quay lại
            button.btn.btn-primary(type="submit")
              i.bi.bi-check-lg.me-1
              = mode==='create' ? 'Tạo khóa học' : 'Cập nhật'

    // Notes khi tạo mới
    if mode === 'create'
      .notes-card
        .d-flex.align-items-start.gap-2
          i.bi.bi-lightbulb.text-info.mt-1
          .small
            strong Lưu ý:
            ul
              li Slug nên ngắn gọn, không dấu, cách nhau bằng dấu gạch ngang
              li Có thể cập nhật ảnh khóa học sau khi tạo
              li Trạng thái mặc định là "Bản nháp" trước khi xuất bản
